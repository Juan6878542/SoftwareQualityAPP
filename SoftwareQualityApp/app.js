// app.js - lógica de evaluación (común a evaluacion.html)
function getFormValues(){const f=document.getElementById('evalForm');const d={}; new FormData(f).forEach((v,k)=>{d[k]=Number(v)});return d;}
function mean(arr){return arr.length?arr.reduce((a,b)=>a+b,0)/arr.length:0;}
function clampScore(s){if(isNaN(s))return 0;return Math.max(0,Math.min(5,Math.round(s*100)/100));}
function calculate(){const v=getFormValues();const calidad=[v.funcionalidad,v.fiabilidad,v.usabilidad,v.eficiencia];const codigo=[v.legibilidad,v.documentacion,v.unitarias];const programacion=[v.modularidad,v.errores,v.seguridad];const avgCalidad=mean(calidad);const avgCodigo=mean(codigo);const avgProgramacion=mean(programacion);const wCalidad=0.5,wCodigo=0.3,wProgramacion=0.2;const finalScore=clampScore(avgCalidad*wCalidad+avgCodigo*wCodigo+avgProgramacion*wProgramacion);return {inputs:v,breakdown:{calidad:{score:clampScore(avgCalidad),weight:wCalidad},codigo:{score:clampScore(avgCodigo),weight:wCodigo},programacion:{score:clampScore(avgProgramacion),weight:wProgramacion},final:{score:finalScore}}};}
function renderResult(res){const area=document.getElementById('resultArea');const final=res.breakdown.final.score;area.innerHTML=`<h3>Resultado</h3><p>Puntuación final (0 - 5): <strong>${final}</strong></p><p>Desglose por categoría:</p><ul><li>Estándares de Calidad: ${res.breakdown.calidad.score} (peso ${res.breakdown.calidad.weight*100}%)</li><li>Código: ${res.breakdown.codigo.score} (peso ${res.breakdown.codigo.weight*100}%)</li><li>Programación: ${res.breakdown.programacion.score} (peso ${res.breakdown.programacion.weight*100}%)</li></ul><details><summary>Ver datos completos (JSON)</summary><pre>${JSON.stringify(res,null,2)}</pre></details>`;}
document.getElementById('calculateBtn')?.addEventListener('click',()=>{renderResult(calculate());});document.getElementById('exportBtn')?.addEventListener('click',()=>{const r=calculate();const blob=new Blob([JSON.stringify(r,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='evaluacion_software.json';document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);});